#include <stdio.h>
#include <string.h>
#include <stdlib.h>

/* Include polybench common header. */
#define MINI_DATASET
#include "polybench.h"

/* Include benchmark-specific header. */
/* Default data type is double, default size is 4000. */
#include "2mm.h"

void kernel2_2mm(int ni, int nj, int nk, int nl,
		DATA_TYPE alpha,
		DATA_TYPE beta,
		DATA_TYPE tmp[NI][NJ],
		DATA_TYPE A[NI][NK],
		DATA_TYPE B[NK][NJ],
		DATA_TYPE C[NL][NJ],
		DATA_TYPE D[NI][NL]);

#define LENGTH 32

const double eps = 1e-2;
// Golden result obtained via MATLAB.
double swref_d[LENGTH][LENGTH] = { {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
		{ 3.3727e+08,4.497e+08,5.6212e+08,6.7455e+08,7.8697e+08,8.994e+08,1.0118e+09,1.1242e+09,1.2367e+09,1.3491e+09,1.4615e+09,1.5739e+09,1.6864e+09,1.7988e+09,1.9112e+09,2.0236e+09,2.1361e+09,2.2485e+09,2.3609e+09,2.4733e+09,2.5858e+09,2.6982e+09,2.8106e+09,2.923e+09,3.0355e+09,3.1479e+09,3.2603e+09,3.3727e+09,3.4852e+09,3.5976e+09,3.71e+09,3.8224e+09},
		{ 6.7455e+08,8.994e+08,1.1242e+09,1.3491e+09,1.5739e+09,1.7988e+09,2.0236e+09,2.2485e+09,2.4733e+09,2.6982e+09,2.923e+09,3.1479e+09,3.3727e+09,3.5976e+09,3.8224e+09,4.0473e+09,4.2721e+09,4.497e+09,4.7218e+09,4.9467e+09,5.1715e+09,5.3964e+09,5.6212e+09,5.8461e+09,6.0709e+09,6.2958e+09,6.5206e+09,6.7455e+09,6.9703e+09,7.1952e+09,7.42e+09,7.6449e+09},
		{ 1.0118e+09,1.3491e+09,1.6864e+09,2.0236e+09,2.3609e+09,2.6982e+09,3.0355e+09,3.3727e+09,3.71e+09,4.0473e+09,4.3846e+09,4.7218e+09,5.0591e+09,5.3964e+09,5.7337e+09,6.0709e+09,6.4082e+09,6.7455e+09,7.0828e+09,7.42e+09,7.7573e+09,8.0946e+09,8.4318e+09,8.7691e+09,9.1064e+09,9.4437e+09,9.7809e+09,1.0118e+10,1.0455e+10,1.0793e+10,1.113e+10,1.1467e+10},
		{ 1.3491e+09,1.7988e+09,2.2485e+09,2.6982e+09,3.1479e+09,3.5976e+09,4.0473e+09,4.497e+09,4.9467e+09,5.3964e+09,5.8461e+09,6.2958e+09,6.7455e+09,7.1952e+09,7.6449e+09,8.0946e+09,8.5443e+09,8.994e+09,9.4437e+09,9.8934e+09,1.0343e+10,1.0793e+10,1.1242e+10,1.1692e+10,1.2142e+10,1.2592e+10,1.3041e+10,1.3491e+10,1.3941e+10,1.439e+10,1.484e+10,1.529e+10},
		{ 1.6864e+09,2.2485e+09,2.8106e+09,3.3727e+09,3.9349e+09,4.497e+09,5.0591e+09,5.6212e+09,6.1834e+09,6.7455e+09,7.3076e+09,7.8697e+09,8.4318e+09,8.994e+09,9.5561e+09,1.0118e+10,1.068e+10,1.1242e+10,1.1805e+10,1.2367e+10,1.2929e+10,1.3491e+10,1.4053e+10,1.4615e+10,1.5177e+10,1.5739e+10,1.6302e+10,1.6864e+10,1.7426e+10,1.7988e+10,1.855e+10,1.9112e+10},
		{ 2.0236e+09,2.6982e+09,3.3727e+09,4.0473e+09,4.7218e+09,5.3964e+09,6.0709e+09,6.7455e+09,7.42e+09,8.0946e+09,8.7691e+09,9.4437e+09,1.0118e+10,1.0793e+10,1.1467e+10,1.2142e+10,1.2816e+10,1.3491e+10,1.4166e+10,1.484e+10,1.5515e+10,1.6189e+10,1.6864e+10,1.7538e+10,1.8213e+10,1.8887e+10,1.9562e+10,2.0236e+10,2.0911e+10,2.1586e+10,2.226e+10,2.2935e+10},
		{ 2.3609e+09,3.1479e+09,3.9349e+09,4.7218e+09,5.5088e+09,6.2958e+09,7.0828e+09,7.8697e+09,8.6567e+09,9.4437e+09,1.0231e+10,1.1018e+10,1.1805e+10,1.2592e+10,1.3379e+10,1.4166e+10,1.4952e+10,1.5739e+10,1.6526e+10,1.7313e+10,1.81e+10,1.8887e+10,1.9674e+10,2.0461e+10,2.1248e+10,2.2035e+10,2.2822e+10,2.3609e+10,2.4396e+10,2.5183e+10,2.597e+10,2.6757e+10},
		{ 2.6982e+09,3.5976e+09,4.497e+09,5.3964e+09,6.2958e+09,7.1952e+09,8.0946e+09,8.994e+09,9.8934e+09,1.0793e+10,1.1692e+10,1.2592e+10,1.3491e+10,1.439e+10,1.529e+10,1.6189e+10,1.7089e+10,1.7988e+10,1.8887e+10,1.9787e+10,2.0686e+10,2.1586e+10,2.2485e+10,2.3384e+10,2.4284e+10,2.5183e+10,2.6083e+10,2.6982e+10,2.7881e+10,2.8781e+10,2.968e+10,3.0579e+10},
		{ 3.0355e+09,4.0473e+09,5.0591e+09,6.0709e+09,7.0828e+09,8.0946e+09,9.1064e+09,1.0118e+10,1.113e+10,1.2142e+10,1.3154e+10,1.4166e+10,1.5177e+10,1.6189e+10,1.7201e+10,1.8213e+10,1.9225e+10,2.0236e+10,2.1248e+10,2.226e+10,2.3272e+10,2.4284e+10,2.5296e+10,2.6307e+10,2.7319e+10,2.8331e+10,2.9343e+10,3.0355e+10,3.1366e+10,3.2378e+10,3.339e+10,3.4402e+10},
		{ 3.3727e+09,4.497e+09,5.6212e+09,6.7455e+09,7.8697e+09,8.994e+09,1.0118e+10,1.1242e+10,1.2367e+10,1.3491e+10,1.4615e+10,1.5739e+10,1.6864e+10,1.7988e+10,1.9112e+10,2.0236e+10,2.1361e+10,2.2485e+10,2.3609e+10,2.4733e+10,2.5858e+10,2.6982e+10,2.8106e+10,2.923e+10,3.0355e+10,3.1479e+10,3.2603e+10,3.3727e+10,3.4852e+10,3.5976e+10,3.71e+10,3.8224e+10},
		{ 3.71e+09,4.9467e+09,6.1834e+09,7.42e+09,8.6567e+09,9.8934e+09,1.113e+10,1.2367e+10,1.3603e+10,1.484e+10,1.6077e+10,1.7313e+10,1.855e+10,1.9787e+10,2.1023e+10,2.226e+10,2.3497e+10,2.4733e+10,2.597e+10,2.7207e+10,2.8443e+10,2.968e+10,3.0917e+10,3.2153e+10,3.339e+10,3.4627e+10,3.5863e+10,3.71e+10,3.8337e+10,3.9573e+10,4.081e+10,4.2047e+10},
		{ 4.0473e+09,5.3964e+09,6.7455e+09,8.0946e+09,9.4437e+09,1.0793e+10,1.2142e+10,1.3491e+10,1.484e+10,1.6189e+10,1.7538e+10,1.8887e+10,2.0236e+10,2.1586e+10,2.2935e+10,2.4284e+10,2.5633e+10,2.6982e+10,2.8331e+10,2.968e+10,3.1029e+10,3.2378e+10,3.3727e+10,3.5076e+10,3.6426e+10,3.7775e+10,3.9124e+10,4.0473e+10,4.1822e+10,4.3171e+10,4.452e+10,4.5869e+10},
		{ 4.3846e+09,5.8461e+09,7.3076e+09,8.7691e+09,1.0231e+10,1.1692e+10,1.3154e+10,1.4615e+10,1.6077e+10,1.7538e+10,1.9e+10,2.0461e+10,2.1923e+10,2.3384e+10,2.4846e+10,2.6307e+10,2.7769e+10,2.923e+10,3.0692e+10,3.2153e+10,3.3615e+10,3.5076e+10,3.6538e+10,3.8e+10,3.9461e+10,4.0923e+10,4.2384e+10,4.3846e+10,4.5307e+10,4.6769e+10,4.823e+10,4.9692e+10},
		{ 4.7218e+09,6.2958e+09,7.8697e+09,9.4437e+09,1.1018e+10,1.2592e+10,1.4166e+10,1.5739e+10,1.7313e+10,1.8887e+10,2.0461e+10,2.2035e+10,2.3609e+10,2.5183e+10,2.6757e+10,2.8331e+10,2.9905e+10,3.1479e+10,3.3053e+10,3.4627e+10,3.6201e+10,3.7775e+10,3.9349e+10,4.0923e+10,4.2497e+10,4.407e+10,4.5644e+10,4.7218e+10,4.8792e+10,5.0366e+10,5.194e+10,5.3514e+10},
		{ 5.0591e+09,6.7455e+09,8.4318e+09,1.0118e+10,1.1805e+10,1.3491e+10,1.5177e+10,1.6864e+10,1.855e+10,2.0236e+10,2.1923e+10,2.3609e+10,2.5296e+10,2.6982e+10,2.8668e+10,3.0355e+10,3.2041e+10,3.3727e+10,3.5414e+10,3.71e+10,3.8786e+10,4.0473e+10,4.2159e+10,4.3846e+10,4.5532e+10,4.7218e+10,4.8905e+10,5.0591e+10,5.2277e+10,5.3964e+10,5.565e+10,5.7337e+10},
		{ 5.3964e+09,7.1952e+09,8.994e+09,1.0793e+10,1.2592e+10,1.439e+10,1.6189e+10,1.7988e+10,1.9787e+10,2.1586e+10,2.3384e+10,2.5183e+10,2.6982e+10,2.8781e+10,3.0579e+10,3.2378e+10,3.4177e+10,3.5976e+10,3.7775e+10,3.9573e+10,4.1372e+10,4.3171e+10,4.497e+10,4.6769e+10,4.8567e+10,5.0366e+10,5.2165e+10,5.3964e+10,5.5763e+10,5.7561e+10,5.936e+10,6.1159e+10},
		{ 5.7337e+09,7.6449e+09,9.5561e+09,1.1467e+10,1.3379e+10,1.529e+10,1.7201e+10,1.9112e+10,2.1023e+10,2.2935e+10,2.4846e+10,2.6757e+10,2.8668e+10,3.0579e+10,3.2491e+10,3.4402e+10,3.6313e+10,3.8224e+10,4.0136e+10,4.2047e+10,4.3958e+10,4.5869e+10,4.778e+10,4.9692e+10,5.1603e+10,5.3514e+10,5.5425e+10,5.7337e+10,5.9248e+10,6.1159e+10,6.307e+10,6.4981e+10},
		{ 6.0709e+09,8.0946e+09,1.0118e+10,1.2142e+10,1.4166e+10,1.6189e+10,1.8213e+10,2.0236e+10,2.226e+10,2.4284e+10,2.6307e+10,2.8331e+10,3.0355e+10,3.2378e+10,3.4402e+10,3.6426e+10,3.8449e+10,4.0473e+10,4.2497e+10,4.452e+10,4.6544e+10,4.8567e+10,5.0591e+10,5.2615e+10,5.4638e+10,5.6662e+10,5.8686e+10,6.0709e+10,6.2733e+10,6.4757e+10,6.678e+10,6.8804e+10},
		{ 6.4082e+09,8.5443e+09,1.068e+10,1.2816e+10,1.4952e+10,1.7089e+10,1.9225e+10,2.1361e+10,2.3497e+10,2.5633e+10,2.7769e+10,2.9905e+10,3.2041e+10,3.4177e+10,3.6313e+10,3.8449e+10,4.0585e+10,4.2721e+10,4.4857e+10,4.6993e+10,4.913e+10,5.1266e+10,5.3402e+10,5.5538e+10,5.7674e+10,5.981e+10,6.1946e+10,6.4082e+10,6.6218e+10,6.8354e+10,7.049e+10,7.2626e+10},
		{ 6.7455e+09,8.994e+09,1.1242e+10,1.3491e+10,1.5739e+10,1.7988e+10,2.0236e+10,2.2485e+10,2.4733e+10,2.6982e+10,2.923e+10,3.1479e+10,3.3727e+10,3.5976e+10,3.8224e+10,4.0473e+10,4.2721e+10,4.497e+10,4.7218e+10,4.9467e+10,5.1715e+10,5.3964e+10,5.6212e+10,5.8461e+10,6.0709e+10,6.2958e+10,6.5206e+10,6.7455e+10,6.9703e+10,7.1952e+10,7.42e+10,7.6449e+10},
		{ 7.0828e+09,9.4437e+09,1.1805e+10,1.4166e+10,1.6526e+10,1.8887e+10,2.1248e+10,2.3609e+10,2.597e+10,2.8331e+10,3.0692e+10,3.3053e+10,3.5414e+10,3.7775e+10,4.0136e+10,4.2497e+10,4.4857e+10,4.7218e+10,4.9579e+10,5.194e+10,5.4301e+10,5.6662e+10,5.9023e+10,6.1384e+10,6.3745e+10,6.6106e+10,6.8467e+10,7.0828e+10,7.3188e+10,7.5549e+10,7.791e+10,8.0271e+10},
		{ 7.42e+09,9.8934e+09,1.2367e+10,1.484e+10,1.7313e+10,1.9787e+10,2.226e+10,2.4733e+10,2.7207e+10,2.968e+10,3.2153e+10,3.4627e+10,3.71e+10,3.9573e+10,4.2047e+10,4.452e+10,4.6993e+10,4.9467e+10,5.194e+10,5.4414e+10,5.6887e+10,5.936e+10,6.1834e+10,6.4307e+10,6.678e+10,6.9254e+10,7.1727e+10,7.42e+10,7.6674e+10,7.9147e+10,8.162e+10,8.4094e+10},
		{ 7.7573e+09,1.0343e+10,1.2929e+10,1.5515e+10,1.81e+10,2.0686e+10,2.3272e+10,2.5858e+10,2.8443e+10,3.1029e+10,3.3615e+10,3.6201e+10,3.8786e+10,4.1372e+10,4.3958e+10,4.6544e+10,4.913e+10,5.1715e+10,5.4301e+10,5.6887e+10,5.9473e+10,6.2058e+10,6.4644e+10,6.723e+10,6.9816e+10,7.2401e+10,7.4987e+10,7.7573e+10,8.0159e+10,8.2745e+10,8.533e+10,8.7916e+10},
		{ 8.0946e+09,1.0793e+10,1.3491e+10,1.6189e+10,1.8887e+10,2.1586e+10,2.4284e+10,2.6982e+10,2.968e+10,3.2378e+10,3.5076e+10,3.7775e+10,4.0473e+10,4.3171e+10,4.5869e+10,4.8567e+10,5.1266e+10,5.3964e+10,5.6662e+10,5.936e+10,6.2058e+10,6.4757e+10,6.7455e+10,7.0153e+10,7.2851e+10,7.5549e+10,7.8248e+10,8.0946e+10,8.3644e+10,8.6342e+10,8.904e+10,9.1738e+10},
		{ 8.4318e+09,1.1242e+10,1.4053e+10,1.6864e+10,1.9674e+10,2.2485e+10,2.5296e+10,2.8106e+10,3.0917e+10,3.3727e+10,3.6538e+10,3.9349e+10,4.2159e+10,4.497e+10,4.778e+10,5.0591e+10,5.3402e+10,5.6212e+10,5.9023e+10,6.1834e+10,6.4644e+10,6.7455e+10,7.0265e+10,7.3076e+10,7.5887e+10,7.8697e+10,8.1508e+10,8.4318e+10,8.7129e+10,8.994e+10,9.275e+10,9.5561e+10},
		{ 8.7691e+09,1.1692e+10,1.4615e+10,1.7538e+10,2.0461e+10,2.3384e+10,2.6307e+10,2.923e+10,3.2153e+10,3.5076e+10,3.8e+10,4.0923e+10,4.3846e+10,4.6769e+10,4.9692e+10,5.2615e+10,5.5538e+10,5.8461e+10,6.1384e+10,6.4307e+10,6.723e+10,7.0153e+10,7.3076e+10,7.5999e+10,7.8922e+10,8.1845e+10,8.4768e+10,8.7691e+10,9.0614e+10,9.3537e+10,9.646e+10,9.9383e+10},
		{ 9.1064e+09,1.2142e+10,1.5177e+10,1.8213e+10,2.1248e+10,2.4284e+10,2.7319e+10,3.0355e+10,3.339e+10,3.6426e+10,3.9461e+10,4.2497e+10,4.5532e+10,4.8567e+10,5.1603e+10,5.4638e+10,5.7674e+10,6.0709e+10,6.3745e+10,6.678e+10,6.9816e+10,7.2851e+10,7.5887e+10,7.8922e+10,8.1958e+10,8.4993e+10,8.8028e+10,9.1064e+10,9.4099e+10,9.7135e+10,1.0017e+11,1.0321e+11},
		{ 9.4437e+09,1.2592e+10,1.5739e+10,1.8887e+10,2.2035e+10,2.5183e+10,2.8331e+10,3.1479e+10,3.4627e+10,3.7775e+10,4.0923e+10,4.407e+10,4.7218e+10,5.0366e+10,5.3514e+10,5.6662e+10,5.981e+10,6.2958e+10,6.6106e+10,6.9254e+10,7.2401e+10,7.5549e+10,7.8697e+10,8.1845e+10,8.4993e+10,8.8141e+10,9.1289e+10,9.4437e+10,9.7585e+10,1.0073e+11,1.0388e+11,1.0703e+11},
		{ 9.7809e+09,1.3041e+10,1.6302e+10,1.9562e+10,2.2822e+10,2.6083e+10,2.9343e+10,3.2603e+10,3.5863e+10,3.9124e+10,4.2384e+10,4.5644e+10,4.8905e+10,5.2165e+10,5.5425e+10,5.8686e+10,6.1946e+10,6.5206e+10,6.8467e+10,7.1727e+10,7.4987e+10,7.8248e+10,8.1508e+10,8.4768e+10,8.8028e+10,9.1289e+10,9.4549e+10,9.7809e+10,1.0107e+11,1.0433e+11,1.0759e+11,1.1085e+11},
		{ 1.0118e+10,1.3491e+10,1.6864e+10,2.0236e+10,2.3609e+10,2.6982e+10,3.0355e+10,3.3727e+10,3.71e+10,4.0473e+10,4.3846e+10,4.7218e+10,5.0591e+10,5.3964e+10,5.7337e+10,6.0709e+10,6.4082e+10,6.7455e+10,7.0828e+10,7.42e+10,7.7573e+10,8.0946e+10,8.4318e+10,8.7691e+10,9.1064e+10,9.4437e+10,9.7809e+10,1.0118e+11,1.0455e+11,1.0793e+11,1.113e+11,1.1467e+11},
		{ 1.0455e+10,1.3941e+10,1.7426e+10,2.0911e+10,2.4396e+10,2.7881e+10,3.1366e+10,3.4852e+10,3.8337e+10,4.1822e+10,4.5307e+10,4.8792e+10,5.2277e+10,5.5763e+10,5.9248e+10,6.2733e+10,6.6218e+10,6.9703e+10,7.3188e+10,7.6674e+10,8.0159e+10,8.3644e+10,8.7129e+10,9.0614e+10,9.4099e+10,9.7585e+10,1.0107e+11,1.0455e+11,1.0804e+11,1.1153e+11,1.1501e+11,1.185e+11}};


int main(int argc, char** argv)
{
int errors=0, i, j;

double tmp[LENGTH][LENGTH];
double A[LENGTH][LENGTH];
double B[LENGTH][LENGTH];
double C[LENGTH][LENGTH];
double D[LENGTH][LENGTH];


int ni = LENGTH;
int nj = LENGTH;
int nl = LENGTH;
int nk = LENGTH;

const double alpha = 32412;
const double beta  = 2123;

// Create input stimuli and compute the expected result
for(i = 0; i < LENGTH; i++) {
	for(j = 0; j < LENGTH; j++) {
		A[i][j] = ((DATA_TYPE) i*j) / ni;
		B[i][j] = ((DATA_TYPE) i*(j+1)) / nj;
		C[i][j] = ((DATA_TYPE) i*(j+3)) / nl;
		D[i][j] = ((DATA_TYPE) i*(j+2)) / nk;

		tmp[i][j] = 0;
	}
}


// kernel_2mm: D = alpha*A*B*C + beta*D
//
kernel2_2mm(ni, nj, nk, nl, alpha, beta, tmp, A, B, C, D);


// Check the results against the expected results
for (i=1; i<LENGTH; i++) {
	for (j=1; j<LENGTH; j++) {
		double dig_num = log10(swref_d[i][j]) + 1.0;
		double diff = abs(D[i][j] - swref_d[i][j]) / pow(10, dig_num - 3);
		if(diff > eps ) {
			errors+=1;
		}
	}
}
printf("There are %d error(s) -> test %s\n", errors, errors ? "FAILED" : "PASSED");
// Return a 0 if the results are correct
return errors;
}
